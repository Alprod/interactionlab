{% extends 'base.html.twig' %}
{% block title %}Interactions{% endblock %}
{% set name = app.user.firstname|capitalize ~ ' ' ~ app.user.lastname|capitalize %}
{% block body %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 dark:bg-slate-700">
    <!-- User interaction --->
    <div class="bg-gray-300 bg-opacity-30 rounded-lg m-5 dark:bg-slate-800">
        <div class="mx-auto py-12 px-4 max-w-7xl sm:px-6 lg:px-8 lg:py-10">
            <div class="space-y-12">
                <ul role="list" class="space-y-12 lg:grid lg:grid-cols-1 lg:items-start lg:gap-x-8 lg:gap-y-12 lg:space-y-0">
                    <li>
                        <div class="space-y-4 sm:grid sm:grid-cols-3 sm:gap-6 sm:space-y-0 lg:gap-8">
                            <div class="h-0 aspect-w-3 aspect-h-2 sm:aspect-w-3 sm:aspect-h-4">
                                {% if app.user.avatar is defined and app.user.avatar is not null %}
                                    <img class="object-cover shadow-lg rounded-lg" src="{{ asset('images/avatars/' ~ app.user.avatar ) }}" alt="avatar-{{ app.user.firstname }}">
                                {% else %}
                                    <img class="object-cover shadow-lg rounded-lg" src="{{ asset('images/avatars/avatar_default.jpg') }}" alt="avatar-default">
                                {% endif %}
                            </div>
                            <div class="sm:col-span-2">
                                <h2 class="text-3xl text-gray-900 font-extrabold tracking-tight sm:text-4xl dark:text-gray-300">Bonjour {{ name }}!</h2>
                                <div class="space-y-4 prose">
                                    <div class="text-lg">
                                        <div class="text-lg leading-6 font-medium space-y-1">
                                            <p class="text-gray-500 dark:text-gray-200">Copywriter</p>
                                        </div>
                                        <p class="text-gray-600 dark:text-gray-400">Personne n'a encore écrit de feedback à votre sujet.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Team interaction --->
    <div class="max-w-6xl mx-auto">
        <div class="bg-white overflow-hidden p-4 dark:bg-slate-700">
            <ul role="list" class="grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5">
                {% for interaction in interactions %}
                        <li class="col-span-1 flex flex-col text-center bg-white rounded-lg shadow-lg divide-y divide-gray-200 dark:bg-slate-800 dark:divide-slate-900">
                            <div class="flex-1 flex flex-col p-8">
                                {% if interaction.avatar is defined and interaction.avatar is not null %}
                                <img class="w-32 h-32 flex-shrink-0 mx-auto rounded-full"
                                     src="{{ asset('images/avatars/' ~ interaction.avatar ) }}"
                                     alt="{{ 'avatar-' ~ interaction.firstname }}">
                                {% else %}
                                    <img class="w-32 h-32 flex-shrink-0 mx-auto rounded-full"
                                         src="{{ asset('images/avatars/avatar_default.jpg') }}"
                                         alt="">
                                {% endif %}
                                <h3 class="mt-6 text-gray-900 text-sm font-medium dark:text-gray-300">{{ (interaction.firstname ~ ' ' ~ interaction.lastname)|capitalize }}</h3>
                                <!--
                                Si on souhaite afficher des infos supplémentaire

                                <dl class="mt-1 flex-grow flex flex-col justify-between">
                                    <dt class="sr-only">Title</dt>
                                    <dd class="text-gray-500 text-sm">Paradigm Representative</dd>
                                    <dt class="sr-only">Role</dt>
                                    <dd class="mt-3">
                                      <span class="px-2 py-1 text-green-800 text-xs font-medium bg-green-100 rounded-full">Admin</span>
                                    </dd>
                                </dl>
                                --->
                            </div>
                            <div>
                                <div class="feedbackButton -mt-px flex divide-x divide-gray-200">
                                    <div class="-ml-px w-0 flex-1 flex dark:hover:bg-slate-400 hover:bg-slate-700 hover:opacity-30 hover:rounded-br-lg hover:rounded-bl-lg focus:bg-slate-700  focus:opacity-30 focus:rounded-br-lg focus:rounded-bl-lg">
                                        <button name="user"
                                           data-uid="{{ interaction.id }}"
                                           data-firstname="{{ interaction.firstname }}"
                                           data-lastname="{{ interaction.lastname }}"
                                           data-email="{{ interaction.email }}"
                                           class="dataButtonFeedback relative w-0 flex-1 inline-flex items-center justify-center py-4 text-sm text-gray-700 font-medium border border-transparent rounded-br-lg hover:text-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:focus:text-xl dark:focus:text-gray-50">
                                            <span class="ml-3">Feedback</span>
                                        </button>

                                    </div>
                                </div>
                            </div>
                        </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
    <!-- Modal include --->
    {{ include('home/_modal_feedback.html.twig',{ feedForm : feedForm }) }}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Show and hide Modal
            let modalEvent = document.getElementById('modalEvent');
            let cancelButton = document.querySelector('.cancel');

            //Fermeture de la modal
            cancelButton.addEventListener('click', () => {
                modalEvent.classList.add('hidden');
            });
            //Ouverture de la modal + Transfet de donnée utilisateur
            let titleModal = document.querySelector('.titleModal');
            let uidModal = document.getElementById('uid');
            let uemailModal = document.getElementById('uemail');
            document.getElementsByName('user').forEach((u) =>{
                u.addEventListener('click', () => {
                    // Affichage de la modal
                    modalEvent.classList.remove('hidden');
                    titleModal.innerHTML = u.dataset.firstname + ' ' + u.dataset.lastname;
                    uidModal.value = u.dataset.uid;
                    uemailModal.value  = u.dataset.email;
                    console.log(uemailModal.value);
                })
            });

            let subimitButton = document.querySelector('.submited');
            let textarea = document.getElementById('feedback_comment');
            subimitButton.addEventListener('click', (e) => {
                if( textarea.value === '' ){
                    e.preventDefault()
                    let errorMessage = document.getElementById('errorMessage')
                    errorMessage.innerHTML = 'Ce champs ne doit pas être vide'
                }
            });

            window.addEventListener('load', () => {
                textarea.value = '';
            })

        })
    </script>
{% endblock %}
